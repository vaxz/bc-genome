<?php
/**
 * Locus.php
 * 
 * @copyright --------
 * @license   --------
 * @link      --------
 * 
 */

namespace bcGen\MainBundle\Entity;

use Doctrine\ORM\Mapping as ORM;

/**
 * 
 * Class Locus allows the creation of Locus object and correponds to a table in the database : bc_gen_db.
 * It's related to Locus characteristics 
 *
 * @see Gene Class Gene
 * @see http://www.doctrine-project.org/api/common/2.3/class-Doctrine.Common.Collections.ArrayCollection.html
 * Doctrine documentation on the class ArrayCollection
 * 
 * @author Isabelle GonÃ§alves
 * @author Xavier Sottiaux
 * @version 0.1.0 0.1.0
 *
 * @ORM\Table( name="locus" )
 * @ORM\Entity(repositoryClass="bcGen\MainBundle\Entity\LocusRepository")
 */
class Locus
{
    /**
     * id is a number which identifies a Locus object
	 * id is established by this way:
	 * (chromosome number * 10000 + locus number )
     * @var integer
     *
     * @ORM\Column(name="id", type="integer")
     * @ORM\Id
     * @ORM\GeneratedValue(strategy="NONE")
     */
    private $id;

    /**
     * geneName is the name of the gene located on a Locus object
     * @var string
     *
     * @ORM\Column( name="gene_name", type="string", length=255, nullable=TRUE )
     */
    private $geneName;


    /**
     * locusDesc is a description of a Locus Object
     * @var string
     *
     * @ORM\Column( name="locus_desc", type="text", nullable=TRUE )
     */
    private $locusDesc;
	
	/**
	 * locusGenes gathers all the references of Gene objects linked to the current Locus object
	 * @todo manage the database upkeep with the correct association between entities
	 * @see Gene Class Gene
	 * @see http://www.doctrine-project.org/api/common/2.3/class-Doctrine.Common.Collections.ArrayCollection.html
	 * Doctrine documentation on the class ArrayCollection
	 * 
	 * @ORM\OneToMany( targetEntity="bcGen\MainBundle\Entity\Gene", mappedBy="geneLocus" )
	 */
	 private $locusGenes;
	 
   /**
     * Constructor initializes the ArrayCollections : locusGenes.
     */
    public function __construct()
    {
        $this->locusGenes = new \Doctrine\Common\Collections\ArrayCollection();
    }

   /**
     * Set the id value of a Locus object
     * @param integer $id
     * @return Locus
     */
    public function setId($id)
    {
        $this->id = $id;

        return $this;
    }

    /**
     * Get the id value of a Locus object
     * @return integer 
     */
    public function getId()
    {
        return $this->id;
    }

    /**
     * Set the geneName value of a Locus object
     * @param string $geneName
     * @return Locus
     */
    public function setGeneName($geneName)
    {
        $this->geneName = $geneName;

        return $this;
    }

    /**
     * Get the geneName value of a Locus object
     * @return string 
     */
    public function getGeneName()
    {
        return $this->geneName;
    }

    /**
     * Set the locusDesc value of a Locus object
     * @param string $locusDesc
     * @return Locus
     */
    public function setLocusDesc($locusDesc)
    {
        $this->locusDesc = $locusDesc;

        return $this;
    }

    /**
     * Get the locusDesc value of a Locus object
     * @return string 
     */
    public function getLocusDesc()
    {
        return $this->locusDesc;
    }

    /**
     * Add a Gene object reference to locusGenes
     * @param \bcGen\MainBundle\Entity\Gene $gene
     * @return Locus
     */
    public function addLocusGenes(\bcGen\MainBundle\Entity\Gene $gene)
    {
        $this->locusGenes[] = $locusGenes;
		$gene->setGeneLocus($this);
        return $this;
    }

    /**
     * Remove a Gene object reference to locusGenes
     * @param \bcGen\MainBundle\Entity\Gene $gene
     */
    public function removeLocusGenes(\bcGen\MainBundle\Entity\Gene $gene)
    {
        $this->locusGenes->removeElement($gene);
		$gene->setGeneLocus(NULL);
    }

    /**
     * Get the ArrayCollection : locusGenes 
	 * @see http://www.doctrine-project.org/api/common/2.3/class-Doctrine.Common.Collections.ArrayCollection.html
	 * Doctrine documentation on the class ArrayCollection
	 * @return \Doctrine\Common\Collections\Collection
     */
    public function getLocusGenes()
    {
        return $this->locusGenes;
    }
	
	/**
	 * This method generates an array containing gene accession numbers but sorted.
	 * The accesion numbers are ordered in this way : those starting by "BCIN", then, "B0510", "BC1G", "BCT4" and "BOFU" 
	 * @todo Do the dockbloc
	 * 
	 * @see http://www.doctrine-project.org/api/common/2.3/class-Doctrine.Common.Collections.ArrayCollection.html
	 * Doctrine documentation on the class ArrayCollection
	 * @see http://www.doctrine-project.org/api/common/2.1/class-ArrayIterator.html
	 * Doctrine documentation on the class ArrayIterator
	 * @uses ArrayCollection::getIterator()
	 * @uses ArrayCollection::next()
	 * @uses ArrayIterator::valid()
	 * @uses ArrayIterator::current()
	 * 
	 * @return array|null The array is sent if it contains at least one value otherwise null
	 */
	public function GeneAccessionNumberSorted()
	{
		$iterator=$this->locusGenes->getIterator();
		//Initializing the array with no value linked to the keys
		$result=array(
		              'BCIN' => "",
		              'B0510' => "",
		              'BC1G' => "",
		              'BCT4' => "",
		              'BOFU' => ""
					  );
			
	     while( $iterator->valid() ) 
	     {
	     	$accessionNumber=$iterator->current()->getGeneAccession();
			
			if ( substr_compare( $accessionNumber, "BCIN", 0, 4, true ) == 0 )
			{
				$result['BCIN'][]= $accessionNumber;
			}
			else if ( substr_compare( $accessionNumber, "B0510", 0, 5, true ) == 0 )
			{
				$result['B0510'][]= $accessionNumber;			
			}
			else if ( substr_compare( $accessionNumber, "BC1G", 0, 4, true ) == 0 )
			{
				$result['BC1G'][]= $accessionNumber;
			}
			else if ( substr_compare( $accessionNumber, "BCT4", 0, 4, true ) == 0 )
			{
				$result['BCT4'][]= $accessionNumber;
			}
			else if ( substr_compare( $accessionNumber, "BOFU", 0, 4, true ) == 0 )
			{
				$result['BOFU'][]= $accessionNumber;
			}
			
			$iterator->next(); 
		 }// WHILE LOOP END
		 
		 if ( empty($result) )
		 {
		 	return null;
		 }
		 else
		 {
			 return $result;
		 }
		 	
	}// FUNCTION END
	

    /**
     * Add locusGenes
     *
     * @param \bcGen\MainBundle\Entity\Gene $locusGenes
     * @return Locus
     */
    public function addLocusGene(\bcGen\MainBundle\Entity\Gene $locusGenes)
    {
        $this->locusGenes[] = $locusGenes;

        return $this;
    }

    /**
     * Remove locusGenes
     *
     * @param \bcGen\MainBundle\Entity\Gene $locusGenes
     */
    public function removeLocusGene(\bcGen\MainBundle\Entity\Gene $locusGenes)
    {
        $this->locusGenes->removeElement($locusGenes);
    }
}
